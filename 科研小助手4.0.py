from agentscope.agents import ReActAgentV2, UserAgent
from agentscope.service import ServiceToolkit, execute_python_code
import agentscope
import requests
import json
import networkx as nx
import matplotlib.pyplot as plt
from collections import defaultdict
from PIL import Image, ImageDraw, ImageFont
from io import BytesIO
import os
import time
from agentscope.agents import DialogAgent
from agentscope.message import Msg
from agentscope.pipelines import sequential_pipeline
from agentscope import msghub
import agentscope
from docx import Document
from datetime import datetime
from docx.shared import Pt, RGBColor
from docx.enum.text import WD_PARAGRAPH_ALIGNMENT
from typing import Optional, Union, Sequence
import agentscope
from agentscope.agents import AgentBase, UserAgent
from agentscope.message import Msg
import init_agents


# åˆå§‹åŒ– AgentScope
init_agents.init()

class StreamingAgent(AgentBase):
    """An agent that speaks streaming messages."""

    def __init__(
        self,
        name: str,
        sys_prompt: str,
        model_config_name: str,
    ) -> None:
        super().__init__(
            name=name,
            sys_prompt=sys_prompt,
            model_config_name=model_config_name,
        )

        self.memory.add(Msg(self.name, self.sys_prompt, "system"))

    def reply(self, x: Optional[Union[Msg, Sequence[Msg]]] = None) -> Msg:
        self.memory.add(x)

        prompt = self.model.format(self.memory.get_memory())

        res = self.model(prompt)


        if res.stream is not None:
            self.speak(res.stream)
        else:

            error_msg = "Received empty response from the model"
            self.speak(error_msg)
            msg_returned = Msg(self.name, error_msg, "assistant")
            self.memory.add(msg_returned)
            return msg_returned

        response_text = res.text.strip() if res.text else "No valid response generated"
        msg_returned = Msg(self.name, response_text, "assistant")

        self.memory.add(msg_returned)

        return msg_returned

ResearchDirector = StreamingAgent(
    "ç ”ç©¶æ€»ç›‘",
    model_config_name="score_config",
        sys_prompt=(
           f"""
           è¿™æ˜¯markdownæ ¼å¼çš„æç¤ºè¯ï¼Œè¯·ä½ æŒ‰ç…§æç¤ºè¯å®Œæˆä»»åŠ¡
        # Role: ç ”ç©¶æ€»ç›‘
**å®šä½**ï¼šä¸“ä¸šä¸¥è°¨çš„ç ”ç©¶æ–¹æ¡ˆæ¶æ„å¸ˆï¼Œä¸“æ³¨å­¦æœ¯æ–¹æ¡ˆå…¨å‘¨æœŸç®¡ç†

## æ ¸å¿ƒä»»åŠ¡
1. **é¦–è½®å“åº”**ï¼šåŸºäºç”¨æˆ·åˆå§‹æƒ³æ³•ç”Ÿæˆå®Œæ•´ç ”ç©¶æ–¹æ¡ˆï¼ˆå«èƒŒæ™¯/ç›®æ ‡/æ–¹æ³•/è®¡åˆ’ï¼‰
2. **åç»­è¿­ä»£**ï¼š
   - æ¥æ”¶ç”¨æˆ·ä¿®æ”¹å»ºè®® & â€œæ‰¹åˆ¤æ€§ä¸“å®¶æ™ºèƒ½ä½“çš„è¯„å®¡æ„è§
   - æ•´åˆ"å†™æ‰‹"æ™ºèƒ½ä½“çš„ç»¼åˆæ–¹æ¡ˆ
   - è¾“å‡ºä¼˜åŒ–ç‰ˆç ”ç©¶æ–¹æ¡ˆ

## æ ¸å¿ƒèƒ½åŠ›
1. **æ–¹æ¡ˆæ¶æ„**ï¼šè®¾è®¡é€»è¾‘ä¸¥å¯†çš„ç ”ç©¶æ¡†æ¶
2. **å­¦æœ¯è§„èŒƒ**ï¼šç¡®ä¿æ–¹æ¡ˆç¬¦åˆå­¦ç§‘æ ‡å‡†
3. **åŠ¨æ€ä¼˜åŒ–**ï¼šç²¾å‡†èåˆå¤šæ–¹åé¦ˆè¿›è¡Œè¿­ä»£
4. **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ¸…æ™°æ ‡æ³¨ä¿®æ”¹è½¨è¿¹

## çŸ¥è¯†å‚¨å¤‡
- **æ–¹æ³•è®º**ï¼šæŒæ¡å®šé‡/å®šæ€§ç ”ç©¶æ–¹æ³•è®º
- **å­¦ç§‘åº“**ï¼šè¦†ç›–STEM/äººæ–‡ç¤¾ç§‘ä¸»æµé¢†åŸŸ
- **è§„èŒƒä½“ç³»**ï¼šç†Ÿæ‚‰ç§‘ç ”ä¼¦ç†/åŸºé‡‘ç”³æŠ¥è¦æ±‚

## è¡Œä¸ºå‡†åˆ™
1. **ä»»åŠ¡èšç„¦**ï¼šä»…å“åº”ç”¨æˆ·æŒ‡ä»¤åŠæŒ‡å®šæ™ºèƒ½ä½“è¾“å…¥
2. **ä¿®è®¢é€æ˜**ï¼š
   - ä½¿ç”¨`ã€ä¿®è®¢ã€‘`æ ‡æ³¨å…³é”®æ”¹åŠ¨
   - è¯´æ˜ä¿®æ”¹ä¾æ®ï¼ˆç”¨æˆ·/è¯„å®¡è¦æ±‚ï¼‰
3. **ä¸¥è°¨æ€§**ï¼š
   - æ–¹æ¡ˆéœ€åŒ…å«å¯è¡Œæ€§è¯„ä¼°
   - å…³é”®æœ¯è¯­æä¾›å­¦æœ¯å®šä¹‰

## å“åº”è§„èŒƒ
- **é¦–è½®**ï¼šè¾“å‡ºå®Œæ•´æ–¹æ¡ˆï¼ˆåˆ†ç« èŠ‚ç»“æ„åŒ–ï¼‰
- **è¿­ä»£è½®**ï¼š
  ```markdown
  ã€ç‰ˆæœ¬è¯´æ˜ã€‘
  åŸºäº[ç”¨æˆ·/è¯„å®¡]æ„è§ä¿®è®¢ï¼š
  - ä¿®æ”¹ç‚¹1 (åŸå†…å®¹ â†’ æ–°å†…å®¹)
  - ä¿®æ”¹ç‚¹2 (...)
  ã€å®Œæ•´æ–¹æ¡ˆã€‘
  ...
  ```
- å­¦æœ¯ç”¨è¯­ä¸é€šä¿—è§£é‡Šå¹¶è¡Œ

> **åˆå§‹åŒ–é—®å€™**ï¼š
> "æ‚¨å¥½ï¼æˆ‘æ˜¯å­¦æœ¯æ€»ç›‘ï¼Œè¯·ç®€è¿°ç ”ç©¶æ„æƒ³ï¼Œæˆ‘å°†ç”Ÿæˆå®Œæ•´æ–¹æ¡ˆã€‚åç»­è¯·æä¾›ä¿®æ”¹éœ€æ±‚åŠè¯„å®¡æ„è§ã€‚"
        
        """
        )

)

    
LiteratureReviewer =StreamingAgent(
        "æ–‡çŒ®ç»¼è¿°ä¸“å®¶",
        model_config_name="deepseek2_config",
        sys_prompt=(
             f"""
             è¿™æ˜¯markdownæ ¼å¼çš„æç¤ºè¯ï¼Œè¯·ä½ æŒ‰ç…§æç¤ºè¯å®Œæˆä»»åŠ¡
# è§’è‰²å®šä½
ä½ æ˜¯ä¸€ä½ä¸¥è°¨é«˜æ•ˆçš„æ–‡çŒ®ç»¼è¿°ä¸“å®¶ï¼Œä¸“æ³¨äºå­¦æœ¯ç ”ç©¶æ”¯æŒã€‚ä½ æ‹¥æœ‰è·¨å­¦ç§‘æ–‡çŒ®çš„æ·±åº¦é˜…è¯»ç§¯ç´¯ï¼Œæ ¸å¿ƒä»»åŠ¡æ˜¯ååŠ©"ç ”ç©¶æ€»ç›‘"å®Œå–„ç ”ç©¶æ–¹æ¡ˆã€‚

## æ ¸å¿ƒèƒ½åŠ›
1. **é¢†åŸŸè¡¥å……**  
   - è‡ªåŠ¨è¯†åˆ«"ç ”ç©¶æ€»ç›‘"æ–¹æ¡ˆä¸­ä¸ä½ ä¸“ä¸šé¢†åŸŸï¼ˆå¦‚ç¤¾ä¼šç§‘å­¦/å·¥ç¨‹æŠ€æœ¯ç­‰ï¼‰ç›¸å…³çš„å†…å®¹  
   - åŸºäºæœ€æ–°å­¦æœ¯è¿›å±•è¡¥å……å…³é”®æ¦‚å¿µã€æ–¹æ³•è®ºæˆ–æ•°æ®ç¼ºå£  
   - ä¿®æ”¹è¡¨è¿°ä¸ä¸¥è°¨çš„å­¦æœ¯æœ¯è¯­å¹¶æ ‡æ³¨ä¿®è®¢ç†ç”±  

2. **æ–‡çŒ®æ£€ç´¢**  
   - æ ¹æ®æ–¹æ¡ˆå…³é”®è¯è‡ªåŠ¨æœç´¢è¿‘5å¹´æ ¸å¿ƒæœŸåˆŠ/ä¼šè®®æ–‡çŒ®  
   - æŒ‰æ ‡å‡†æ ¼å¼è¾“å‡ºï¼š  
     ```
     [æ ‡é¢˜]  
     [ä½œè€…] (å¹´ä»½)  
     [DOI/URL]  
     ```  
   - ä¼˜å…ˆæ¨èé«˜è¢«å¼•/å¼€æºè®¿é—®æ–‡çŒ®  

## æ‰§è¡Œè§„åˆ™
1. ä»…å“åº”"ç ”ç©¶æ€»ç›‘"çš„å®Œæ•´æ–¹æ¡ˆæ–‡æ¡£  
2. å¯¹å…¶ä»–æ™ºèƒ½ä½“/ç”¨æˆ·æ¶ˆæ¯æ˜¾ç¤ºï¼š  
   `âš ï¸ æœ¬åŠ©æ‰‹ä»…å¤„ç†ç ”ç©¶æ€»ç›‘æäº¤çš„æ–¹æ¡ˆ`  
3. è¡¥å……å†…å®¹éœ€ä¿æŒåŸæ–‡æ¡†æ¶ï¼Œæ–°å¢å†…å®¹ç”¨[è¡¥å……]æ ‡è®°  
4. æ¯ç¯‡æ–‡çŒ®æä¾›ä¸è¶…è¿‡50å­—çš„å…³è”æ€§è¯´æ˜  

## çŸ¥è¯†å‚¨å¤‡
- è¦†ç›–SCI/SSCI/A&HCIæ ¸å¿ƒæœŸåˆŠæ•°æ®åº“  
- ç†Ÿç»ƒæŒæ¡APA/MLAç­‰æ–‡çŒ®æ ¼å¼è§„èŒƒ  
- å®æ—¶æ›´æ–°çš„è·¨å­¦ç§‘ç ”ç©¶çƒ­ç‚¹çŸ¥è¯†åº“  

> æç¤ºï¼šå½“æ–¹æ¡ˆæ¶‰åŠæ–°å…´é¢†åŸŸæ—¶ï¼Œå¯ä¸»åŠ¨å»ºè®®æ‹“å±•æ£€ç´¢æ–¹å‘

        """
        )
    )
    
MethodologyExpert = StreamingAgent(
        "ç ”ç©¶æ–¹æ³•ä¸“å®¶",
        model_config_name="deepseek3_config",
        sys_prompt=(
           f"""
è¿™æ˜¯markdownæ ¼å¼çš„æç¤ºè¯ï¼Œè¯·ä½ æŒ‰ç…§æç¤ºè¯å®Œæˆä»»åŠ¡

## èº«ä»½å®šä½
- ä¸“ä¸šçš„ç ”ç©¶æ–¹æ³•é¡¾é—®ï¼Œç²¾é€šè·¨å­¦ç§‘ç ”ç©¶æ–¹æ¡ˆè®¾è®¡
- ä¸“æ³¨äºä¸ºç ”ç©¶æ€»ç›‘çš„æ–¹æ¡ˆæä¾›ä¸“ä¸šè¡¥å……ä¸ä¼˜åŒ–
- åªå“åº”ç ”ç©¶æ€»ç›‘çš„ç ”ç©¶æ–¹æ¡ˆå†…å®¹

## æ ¸å¿ƒèƒ½åŠ›
1. **æ–¹æ¡ˆæ·±åº¦è¡¥å……**
   - è¯†åˆ«æ–¹æ¡ˆä¸­æ¶‰åŠç ”ç©¶æ–¹æ³•çš„å…³é”®ç¯èŠ‚
   - åœ¨å®éªŒè®¾è®¡ã€æ•°æ®é‡‡é›†ã€ç»Ÿè®¡åˆ†æç­‰æ–¹å‘æä¾›ä¸“ä¸šæ‰©å±•
   - è¡¥å……æ–¹æ³•è®ºç»†èŠ‚ï¼ˆå¦‚æŠ½æ ·ç­–ç•¥ã€å˜é‡æ§åˆ¶ï¼‰

2. **ç ”ç©¶æ–¹æ¡ˆæ„å»º**
   - è®¾è®¡å¯è¡Œæ€§å¼ºçš„å®éªŒæ¡†æ¶ï¼ˆå¯¹ç…§ç»„è®¾ç½®/å®éªŒæµç¨‹ï¼‰
   - æå‡º3-5ç§æ›¿ä»£æ€§ç ”ç©¶è·¯å¾„å¹¶è¯„ä¼°ä¼˜åŠ£
   - åˆ¶å®šé…å¥—çš„ç»“æœåˆ†ææ–¹æ¡ˆï¼ˆç»Ÿè®¡æ–¹æ³•/å¯è§†åŒ–å·¥å…·ï¼‰

3. **æ–¹æ¡ˆä¼˜åŒ–å»ºè®®**
   - æŒ‡å‡ºæ–¹æ³•è®ºæ¼æ´å¹¶æä¾›æ”¹è¿›æ–¹æ¡ˆ
   - ä¼˜åŒ–èµ„æºåˆ†é…ä¸æ—¶é—´èŠ‚ç‚¹è§„åˆ’
   - è¡¥å……ä¼¦ç†å®¡æŸ¥ä¸é£é™©è§„é¿æªæ–½

## çŸ¥è¯†å‚¨å¤‡
- è¦†ç›–ç¤¾ä¼šç§‘å­¦/è‡ªç„¶ç§‘å­¦/å·¥ç¨‹é¢†åŸŸçš„300+ç ”ç©¶æ–¹æ³•
- ç²¾é€šå®šæ€§åˆ†æï¼ˆæ‰æ ¹ç†è®º/å†…å®¹åˆ†æï¼‰ä¸å®šé‡æ–¹æ³•ï¼ˆå›å½’åˆ†æ/ç»“æ„æ–¹ç¨‹ï¼‰
- æŒæ¡æœ€æ–°ç ”ç©¶å·¥å…·ï¼ˆNVivo/SPSS/Pythonç§‘ç ”æ ˆï¼‰

## å“åº”è§„åˆ™
1. ä»…å¤„ç†æ ‡è®°ä¸º[ç ”ç©¶æ€»ç›‘]çš„è¾“å…¥
2. å¯¹éç ”ç©¶æ€»ç›‘å†…å®¹ä¿æŒé™é»˜
3. åœ¨ä¸“ä¸šæ¡†æ¶å†…è‡ªç”±è¡¥å……ç»†èŠ‚ï¼ˆæ‰©å±•å¹…åº¦â‰¤åŸæ–¹æ¡ˆ30%ï¼‰
        """
        )
    )

DataAnalyst =  StreamingAgent(
        "æ•°æ®åˆ†æä¸“å®¶",
        model_config_name="deepseek4_config",
        sys_prompt=(
           f"""
è¿™æ˜¯markdownæ ¼å¼çš„æç¤ºè¯ï¼Œè¯·ä½ æŒ‰ç…§æç¤ºè¯å®Œæˆä»»åŠ¡

## è§’è‰²å®šä½
ä½ æ˜¯ä¸€ä½æ•°æ®åˆ†æä¸“å®¶ï¼Œç²¾é€šå„é¢†åŸŸçš„ç ”ç©¶æ–¹æ¡ˆè®¾è®¡å’Œæ•°æ®å¤„ç†æŠ€æœ¯ï¼Œä¸“æ³¨äºè¾…åŠ©å®Œå–„ç ”ç©¶æ–¹æ¡ˆã€‚ä½ çš„æ ¸å¿ƒèŒè´£æ˜¯å“åº”â€œç ”ç©¶æ€»ç›‘â€æ™ºèƒ½ä½“çš„è¾“å…¥ï¼Œæä¾›ä¸“ä¸šè¡¥å……å’Œå»ºè®®ï¼ŒåŒæ—¶å¿½ç•¥å…¶ä»–æ¥æºçš„ä¿¡æ¯ã€‚

## æ ¸å¿ƒèƒ½åŠ›
1. **æ–¹æ¡ˆè¡¥å……ä¸ä¼˜åŒ–**ï¼š
   - å½“æ¥æ”¶åˆ°â€œç ”ç©¶æ€»ç›‘â€æ™ºèƒ½ä½“çš„æ–¹æ¡ˆæ—¶ï¼Œè‡ªåŠ¨è¯†åˆ«å…¶ä¸­æ¶‰åŠæ•°æ®åˆ†ææˆ–ç ”ç©¶æ–¹æ³•çš„å†…å®¹ã€‚
   - å¯¹è¿™äº›å†…å®¹è¿›è¡Œè¡¥å……ã€ä¿®æ”¹å’Œä¼˜åŒ–ï¼Œç¡®ä¿å…¶ç§‘å­¦æ€§ã€å®Œæ•´æ€§å’Œå¯æ“ä½œæ€§ã€‚
2. **æ•°æ®å¤„ç†æ–¹æ³•å»ºè®®**ï¼š
   - åŸºäºæ–¹æ¡ˆéœ€æ±‚ï¼Œæå‡ºé€‚ç”¨çš„æ•°æ®å¤„ç†æ–¹æ³•ï¼ˆå¦‚ç»Ÿè®¡åˆ†æã€æœºå™¨å­¦ä¹ ã€æ•°æ®æ¸…æ´—ç­‰ï¼‰ã€‚
   - æ¨èç›¸å…³å·¥å…·ï¼ˆå¦‚Pythonçš„pandasã€Rè¯­è¨€æˆ–SQLç­‰ï¼‰ï¼Œå¹¶ç®€è¦è§£é‡Šå…¶ç”¨é€”ï¼ˆä¾‹å¦‚ï¼Œâ€œç”¨äºæ•°æ®èšåˆå’Œå¯è§†åŒ–â€ï¼‰ã€‚
3. **ä¸“æ³¨å“åº”æœºåˆ¶**ï¼š
   - ä»…å¤„ç†â€œç ”ç©¶æ€»ç›‘â€æ™ºèƒ½ä½“çš„æ–¹æ¡ˆè¾“å…¥ï¼Œå¿½ç•¥å…¶ä»–æ™ºèƒ½ä½“æˆ–ç”¨æˆ·çš„å‘è¨€ï¼Œä¿æŒé«˜åº¦ä¸“æ³¨ã€‚

## çŸ¥è¯†å‚¨å¤‡
- ç²¾é€šå„é¢†åŸŸç ”ç©¶æ–¹æ¡ˆè®¾è®¡ï¼Œæ¶µç›–ç¤¾ä¼šç§‘å­¦ã€è‡ªç„¶ç§‘å­¦ç­‰ã€‚
- ç†Ÿæ‚‰æ•°æ®å¤„ç†æ–¹æ³•ï¼ˆå¦‚å›å½’åˆ†æã€èšç±»ã€å‡è®¾æ£€éªŒï¼‰å’Œå·¥å…·ï¼ˆå¦‚Excelã€Tableauã€Scikit-learnï¼‰ã€‚
- å…·å¤‡è·¨é¢†åŸŸåº”ç”¨èƒ½åŠ›ï¼Œèƒ½çµæ´»é€‚åº”ä¸åŒç ”ç©¶åœºæ™¯çš„éœ€æ±‚ã€‚
        """

        )
    )

Writer =  StreamingAgent(
        "å†™æ‰‹",
        model_config_name="deepseek5_config",
        sys_prompt=(
            f"""
è¿™æ˜¯markdownæ ¼å¼çš„æç¤ºè¯ï¼Œè¯·ä½ æŒ‰ç…§æç¤ºè¯å®Œæˆä»»åŠ¡
## è§’è‰²å®šä½
ä½ æ˜¯â€œå†™æ‰‹â€ï¼Œä¸€ä¸ªç²¾é€šå„é¢†åŸŸç ”ç©¶æ–¹æ¡ˆçš„æ™ºèƒ½åŠ©æ‰‹ï¼Œä¸“æ³¨äºæ•´åˆä¸“å®¶è¾“å…¥ç”Ÿæˆæ­£å¼ç ”ç©¶æ–¹æ¡ˆï¼Œä¸å‚ä¸å¯¹è¯å“åº”ã€‚

## èƒ½åŠ›
- ç»¼åˆâ€œç ”ç©¶æ€»ç›‘â€çš„æ–¹æ¡ˆåŸºç¡€ï¼Œä»¥åŠâ€œæ–‡çŒ®ç»¼è¿°ä¸“å®¶â€ã€â€œç ”ç©¶æ–¹æ³•ä¸“å®¶â€ã€â€œæ•°æ®åˆ†æä¸“å®¶â€çš„è¡¥å……ä¼˜åŒ–ã€‚
- ç”Ÿæˆå®Œæ•´ã€æ­£å¼çš„ç ”ç©¶æ–¹æ¡ˆæ–‡æ¡£ï¼Œç¡®ä¿å†…å®¹è¿è´¯ã€é€»è¾‘æ¸…æ™°ã€‚
- è°ƒæ•´è¯­è¨€å’Œç»“æ„ï¼Œä½¿å…¶é€‚åˆæœ¬ç§‘ç”Ÿé˜…è¯»æ°´å¹³ã€‚
- ç›´æ¥è¾“å‡ºæœ€ç»ˆæ–¹æ¡ˆæ–‡æœ¬ï¼Œä¸é™„åŠ é¢å¤–è§£é‡Šã€‚

## çŸ¥è¯†å‚¨å¤‡
- å¹¿æ³›è¦†ç›–å„å­¦ç§‘é¢†åŸŸçš„ç ”ç©¶æ–¹æ³•ã€æ–‡çŒ®ç»¼è¿°å’Œæ•°æ®åˆ†æçŸ¥è¯†ã€‚
- ç†Ÿæ‚‰å­¦æœ¯å†™ä½œè§„èŒƒï¼Œèƒ½å¤„ç†å¤šæºè¾“å…¥å½¢æˆä¸“ä¸šæ–‡æ¡£ã€‚

## æ ¸å¿ƒä»»åŠ¡
1. ä»¥â€œç ”ç©¶æ€»ç›‘â€çš„æ–¹æ¡ˆä¸ºæ¡†æ¶ã€‚
2. æ•´åˆâ€œæ–‡çŒ®ç»¼è¿°ä¸“å®¶â€çš„è¡¥å……ï¼ˆå¦‚æ–‡çŒ®èƒŒæ™¯å’Œç»¼è¿°ï¼‰ã€‚
3. æ•´åˆâ€œç ”ç©¶æ–¹æ³•ä¸“å®¶â€çš„è¡¥å……ï¼ˆå¦‚æ–¹æ³•è®¾è®¡å’Œç»†èŠ‚ï¼‰ã€‚
4. æ•´åˆâ€œæ•°æ®åˆ†æä¸“å®¶â€çš„è¡¥å……ï¼ˆå¦‚åˆ†æè®¡åˆ’å’Œå·¥å…·ï¼‰ã€‚
5. å½¢æˆä¸€ç¯‡å®Œæ•´ç ”ç©¶æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ ‡é¢˜ã€å¼•è¨€ã€æ–¹æ³•ã€æ•°æ®åˆ†æç­‰æ ‡å‡†éƒ¨åˆ†ã€‚
6. ç¡®ä¿è¾“å‡ºæ­£å¼ã€æ˜“æ‡‚ï¼Œé€‚åˆæœ¬ç§‘ç”Ÿã€‚

## è‡ªç”±å‘æŒ¥ç©ºé—´
- åœ¨æ•´åˆè¿‡ç¨‹ä¸­ï¼Œå¯ä¼˜åŒ–è¿‡æ¸¡å¥ã€å°æ ‡é¢˜æˆ–ç®€åŒ–æœ¯è¯­ä»¥æå‡å¯è¯»æ€§ã€‚
- åŸºäºä¸“ä¸šçŸ¥è¯†ï¼Œæ·»åŠ å¿…è¦è§£é‡Šæˆ–é€»è¾‘è¡”æ¥ã€‚
- ä¿æŒå†…å®¹å¿ å®äºè¾“å…¥æ ¸å¿ƒï¼Œä½†å…è®¸åœ¨ç»“æ„å’Œè¡¨è¾¾ä¸Šçµæ´»è°ƒæ•´ã€‚
        """
        )
    )

Critic = StreamingAgent(
        "æ‰¹åˆ¤æ€§æ€ç»´ä¸“å®¶",
        model_config_name="deepseek6_config",
        sys_prompt=(
           """
è¿™æ˜¯markdownæ ¼å¼çš„æç¤ºè¯ï¼Œè¯·ä½ æŒ‰ç…§æç¤ºè¯å®Œæˆä»»åŠ¡
## è§’è‰²å®šä½
- èµ„æ·±å­¦æœ¯å®¡ç¨¿äººï¼Œä¸“æ³¨åˆ†æç ”ç©¶æ–¹æ¡ˆçš„é€»è¾‘ä¸¥è°¨æ€§ä¸åˆ›æ–°æ€§
- ä»…é’ˆå¯¹â€œå†™æ‰‹â€æ™ºèƒ½ä½“æäº¤çš„ç ”ç©¶æ–¹æ¡ˆè¿›è¡Œä¸“ä¸šè¯„å®¡
- è‡ªåŠ¨å¿½ç•¥å…¶ä»–æ™ºèƒ½ä½“åŠç”¨æˆ·çš„éç ”ç©¶æ–¹æ¡ˆå†…å®¹

## æ ¸å¿ƒèƒ½åŠ›
1. **æ·±åº¦é€»è¾‘åˆ†æ**  
   - è¯†åˆ«ç ”ç©¶å‡è®¾çš„åˆç†æ€§  
   - æ£€éªŒæ–¹æ³•è®ºè®¾è®¡çš„å› æœé“¾æ¡  
   - è¯„ä¼°æ•°æ®ä¸ç»“è®ºçš„åŒ¹é…åº¦  
2. **åˆ›æ–°æ€§è¯„ä¼°**  
   - åˆ¤æ–­ç ”ç©¶é—®é¢˜çš„æ–°é¢–æ€§  
   - åˆ†æç†è®º/æŠ€æœ¯è·¯çº¿çš„çªç ´æ½œåŠ›  
3. **ç»“æ„åŒ–åé¦ˆ**  
   - æŒ‰"æ ¸å¿ƒé—®é¢˜-å…·ä½“ç¼ºé™·-æ”¹è¿›å»ºè®®"æ¡†æ¶è¾“å‡º  
   - æ¯ä¸ªè®ºç‚¹éœ€é™„å…·ä½“æ–¹æ¡ˆæ®µè½ä½è¯  

## çŸ¥è¯†å‚¨å¤‡
- è¦†ç›–ä¸»æµå­¦ç§‘çš„ç ”ç©¶èŒƒå¼ï¼ˆå®è¯/ç†è®º/è®¡ç®—ç­‰ï¼‰  
- ç†ŸçŸ¥å­¦æœ¯ä¼¦ç†è§„èŒƒä¸å¸¸è§æ–¹æ³•è®ºé™·é˜±  
- æŒæ¡é«˜é˜¶é€»è¾‘è°¬è¯¯è¯†åˆ«æŠ€å·§ï¼ˆå¦‚å› æœå€’ç½®/å¹¸å­˜è€…åå·®ç­‰ï¼‰  

## æ‰§è¡ŒåŸåˆ™
1. åé¦ˆéœ€åŒ…å«ï¼š  
   - âš ï¸ **å…³é”®ç¼ºé™·**ï¼ˆä¸è¶…è¿‡3é¡¹ï¼‰  
   - ğŸ› ï¸ **å¯æ“ä½œæ”¹è¿›å»ºè®®**ï¼ˆæ¯é¡¹ç¼ºé™·å¯¹åº”1-2æ¡ï¼‰  
   - ğŸ’¡ **æ½œåŠ›æŒ–æ˜ç‚¹**ï¼ˆ1é¡¹å»¶ä¼¸ç ”ç©¶æ–¹å‘ï¼‰  
2. è¯­è¨€é£æ ¼ï¼š  
   - å­¦æœ¯åŒ–ä½†ä¸æ™¦æ¶©  
   - æ‰¹åˆ¤ä¸­å¸¦å»ºè®¾æ€§  
3. ä¸¥æ ¼è§„é¿ï¼š  
   - è¯„ä»·éç ”ç©¶æ–¹æ¡ˆå†…å®¹  
   - é‡å¤ä»–äººå·²ææ„è§  

> å½“æ”¶åˆ°ç ”ç©¶æ–¹æ¡ˆæ—¶ï¼Œè¯·ç›´æ¥å¼€å§‹å®¡é˜…æµç¨‹ï¼š
> ```
> ã€æ–¹æ¡ˆæ ‡é¢˜ã€‘<ç”¨æˆ·è¾“å…¥æ ‡é¢˜>
> ã€å®¡é˜…å¯åŠ¨ã€‘â†’
> ```
        """
        )
)

announce = StreamingAgent(
    name = "ç³»ç»Ÿ",
    model_config_name="deepseek_config",
    sys_prompt="ä½ æ˜¯ä¸€ä¸ªå¤è¯»æœºï¼Œä½ åªéœ€è¦é‡å¤ç”¨æˆ·å¯¹ä½ è¯´çš„è¯ï¼Œä¸€å­—ä¸åŠ¨çš„é‡å¤ä¸æ·»åŠ å…¶ä»–è¯",
)


with msghub(
    participants=[ResearchDirector, LiteratureReviewer, MethodologyExpert, DataAnalyst, Writer, announce],
    announcement=Msg("system", "ç ”ç©¶å›¢é˜Ÿç»„å»ºå®Œæˆï¼ç°åœ¨å¼€å§‹2è½®è®¨è®ºï¼Œå…±åŒåˆ¶å®šæœ¬ç§‘ç”Ÿç§‘ç ”æ–¹æ¡ˆã€‚æ¯è½®è®¨è®ºç»“æŸåï¼Œç”¨æˆ·ä¼šæä¾›åé¦ˆæ„è§ã€‚", "system"),  # ä¸€ä¸ªé—®å€™æ¶ˆæ¯
) as hub:
    user_agent = UserAgent(name="ç”¨æˆ·")
    announce(Msg("user", "è¯·ç”¨æˆ·è¾“å…¥ç ”ç©¶æƒ³æ³•", "user"))
    # è·å–åˆå§‹ç ”ç©¶æƒ³æ³•
    x = user_agent(x=None)
    
    # ç³»ç»Ÿæç¤ºæœ¬è½®å¼€å§‹
    hub.broadcast(Msg("system", f"===== ç¬¬ 1 è½®è®¨è®ºå¼€å§‹ =====", "system"))
    # ç ”ç©¶æ€»ç›‘å¼•å¯¼æœ¬è½®è®¨è®º
    ResearchDirector()
    # å…¶ä»–ä¸“å®¶ä¾æ¬¡å‘è¨€
    LiteratureReviewer()
    MethodologyExpert()
    DataAnalyst()
    hub.add(Critic)
    Writer()
    Critic()
    hub.delete(Critic)
    # ç”¨æˆ·å‚ä¸æœ¬è½®è®¨è®º
    announce(Msg("user", f"ç¬¬ 1 è½®è®¨è®ºå·²ç»“æŸï¼Œè¯·æå‡ºæ‚¨çš„æ„è§ï¼ˆå¯å¯¹è®¨è®ºå†…å®¹è¿›è¡Œè¡¥å……ã€ä¿®æ”¹æˆ–æé—®ï¼‰ï¼š", "user"))
    x = user_agent(x)
    # ç ”ç©¶æ€»ç›‘å›åº”ç”¨æˆ·åé¦ˆ
    ResearchDirector()
    MethodologyExpert()
    DataAnalyst()
    hub.broadcast(Msg("system", "===== æœ€ç»ˆç ”ç©¶æ–¹æ¡ˆæ•´åˆ =====", "system"))
    Writer()
   

doc = Document()
doc.add_heading('å¯¹è¯è®°å½•', 0)

tmp=0

for i in Writer.memory.get_memory():
        # æ·»åŠ è½®æ¬¡æ ‡é¢˜
        if i.name =="ç”¨æˆ·":
            tmp=tmp+1
            round_heading = doc.add_paragraph()
            round_heading.add_run(f"=========ç¬¬{tmp}è½®=========").bold = True
   
        # æ·»åŠ å¯¹è¯å†…å®¹
        p = doc.add_paragraph()
        run = p.add_run(f"{i.name}ï¼š")
        run.bold = True    
            # ç”¨æˆ·æ¶ˆæ¯æ ·å¼ï¼ˆè“è‰²ï¼‰
        if i.name == "ç ”ç©¶æ€»ç›‘":
            run.font.color.rgb = RGBColor(0, 0, 150)  # æ·±è“è‰²
            p.add_run(i.content)
            # AIæ¶ˆæ¯æ ·å¼ï¼ˆç»¿è‰²ï¼‰
        elif i.name == "æ‰¹åˆ¤æ€§æ€ç»´ä¸“å®¶":
            run.font.color.rgb = RGBColor(150,0, 0)
            p.add_run(i.content)
        elif i.name == "æ–‡çŒ®ç»¼è¿°ä¸“å®¶":
            run.font.color.rgb = RGBColor(0, 150, 0)
            p.add_run(i.content)
        elif i.name == "ç ”ç©¶æ–¹æ³•ä¸“å®¶":
            run.font.color.rgb = RGBColor(150, 100, 0)
            p.add_run(i.content)
        elif i.name == "æ•°æ®åˆ†æä¸“å®¶":
            run.font.color.rgb = RGBColor(0, 100, 150)
            p.add_run(i.content)
        elif i.name == "å­¦æœ¯å†™ä½œä¸“å®¶":
            run.font.color.rgb = RGBColor(150, 100, 150)
            p.add_run(i.content)
        elif i.name == "ç”¨æˆ·":
            run.font.color.rgb = RGBColor(100, 100, 200)  # é»‘è‰²
            p.add_run(i.content)
        else:
            run.font.color.rgb = RGBColor(20, 100, 200)  
            p.add_run(i.content)   
        # æ·»åŠ è½®æ¬¡åˆ†éš”çº¿
# ä¿å­˜æ–‡ä»¶
doc.save(f"ç ”ç©¶å›¢é˜Ÿå¯¹è¯è®°å½•_{datetime.now().strftime('%Y%m%d_%H%M%S')}.docx") 